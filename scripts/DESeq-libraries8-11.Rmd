---
title: "DESeq_libraries8-11"
output: html_document
---
Rmd to go through `DESeq2` pipeline. Will check data. Then will perform some DEG analyses. 

Libraries 8-11 info: 
(These were used in the 02-DeSeq-Temperature.Rmd comparing elevated and decreased)     
They are all pooled samples:   
8 --> Day 2, infected, decreased temperature
9 --> Day 2, uninfected, decreased temperature
10 --> Day 2, infected, elevated temperature
11 --> Day 2, uninfected, elevated temperature

```{r}
library(DESeq2)
```
```{r}
library(tidyverse)
```


Read in un-normalized counts:
```{r}
pooldf <- read.table("../data/kallisto-0517.isoform.counts.txt", header = T, sep = "\t")
rownames(pooldf) <- pooldf$FeatureID
pooldf <- pooldf[,-1]
head(pooldf)
```

Rename columns so I know which samples are infected and which are uninfected:
```{r}
colnames(pooldf) <- c("uninfected_cold", "infected_cold", "uninfected_warm", "infected_warm")
head(pooldf)
```


## Get DEGs based on infection comparison:
```{r}
deseq2.colData <- data.frame(condition=factor(c("uninfected", "infected", "uninfected", "infected")), 
                             type=factor(rep("paired-end", 4)))
rownames(deseq2.colData) <- colnames(data)
deseq2.dds <- DESeqDataSetFromMatrix(countData = pooldf,
                                     colData = deseq2.colData, 
                                     design = ~ condition)
```

```{r}
deseq2.dds <- DESeq(deseq2.dds)
deseq2.res <- results(deseq2.dds)
deseq2.res <- deseq2.res[order(rownames(deseq2.res)), ]
```

```{r}
head(deseq2.res)
```

```{r}
# Count number of hits with adjusted p-value less then 0.05
dim(deseq2.res[!is.na(deseq2.res$padj) & deseq2.res$padj <= 0.05, ])
```

```{r}
inf <- deseq2.res
# The main plot
plot(inf$baseMean, inf$log2FoldChange, pch=20, cex=0.45, ylim=c(-15, 15), log="x", col="darkgray",
     #main="Infection Status  (pval </= 0.05)",
     xlab="mean of normalized counts",
     ylab="Log2 Fold Change")
# Getting the significant points and plotting them again so they're a different color
inf.sig <- deseq2.res[!is.na(deseq2.res$padj) & deseq2.res$padj <= 0.05, ]
points(inf.sig$baseMean, inf.sig$log2FoldChange, pch=20, cex=0.45, col="red")
# 2 FC lines
abline(h=c(-1,1), col="blue")
```


## Get DEGs based on infection with temperature as a factor: 
From Multi-factor designs section of: 
http://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#multi-factor-designs 

```{r}
deseq2.colData2 <- data.frame(condition=factor(c("uninfected", "infected", "uninfected", "infected")), 
                             type=factor(rep("paired-end", 4)),
                             temperature=factor(c("decreased", "decreased", "elevated", "elevated")))
rownames(deseq2.colData2) <- colnames(data)
deseq2.dds2 <- DESeqDataSetFromMatrix(countData = pooldf,
                                     colData = deseq2.colData2, 
                                     design = ~ condition + temperature + condition:temperature)
```


```{r}
levels(deseq2.dds2$temperature)
```


```{r}
design(deseq2.dds2) <- formula(~ temperature + condition)
deseq2.dds2 <- DESeq(deseq2.dds2)

```

Access results:
```{r}
results.dds2 <- results(deseq2.dds2)
head(results.dds2)
```

```{r}
# Count number of hits with adjusted p-value less then 0.05
dim(results.dds2[!is.na(results.dds2$padj) & results.dds2$padj <= 0.05, ])
```

```{r}
inf2 <- results.dds2
# The main plot
plot(inf2$baseMean, inf2$log2FoldChange, pch=20, cex=0.45, ylim=c(-15, 15), log="x", col="darkgray",
     #main="Infection Status  (pval </= 0.05)",
     xlab="mean of normalized counts",
     ylab="Log2 Fold Change")
# Getting the significant points and plotting them again so they're a different color
inf2.sig <- results.dds2[!is.na(results.dds2$padj) & results.dds2$padj <= 0.05, ]
points(inf2.sig$baseMean, inf2.sig$log2FoldChange, pch=20, cex=0.45, col="red")
# 2 FC lines
abline(h=c(-1,1), col="blue")
```








